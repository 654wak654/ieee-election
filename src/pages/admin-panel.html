<template x-if="page === 'admin-panel'">
    <div class="hero-body" x-transition:enter="page-transition" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
        <div class="column is-4 is-offset-4">
            <h3 class="title has-text-centered has-text-grey-dark">Yönetici Paneli</h3>
            <hr class="login-hr has-background-grey-dark">
            <nav class="panel has-background-white">
                <p class="panel-heading vertical-middle">
                    <span class="icon"><i class="material-icons">ballot</i></span>
                    <span>Seçim Listesi</span>
                </p>

                <div x-show="elections.some(e => e.active)" class="panel-block has-background-info-dark">
                    <label class="label pr-2 has-text-light">Aktif Seçim:</label>
                    <input class="input is-static has-text-light" type="text" :value="elections.find(e => e.active)?.name" readonly>
                </div>

                <div x-show="elections.some(e => e.active)" class="panel-block has-background-info-dark">
                    <label class="label pr-2 has-text-light">Yönetici:</label>
                    <input class="input is-static has-text-light" type="text" :value="elections.find(e => e.active)?.moderator" readonly>
                </div>

                <template x-for="election in elections" :key="election">
                    <div class="panel-block px-0">
                        <a
                                class="panel-block width-100 has-tooltip-arrow has-tooltip-left"
                                data-tooltip="Seçimi Düzenle" x-text="election.name" @click="editElection(election)"
                        ></a>
                        <a class="button is-info has-tooltip-arrow" :data-tooltip="election.active ? 'Seçimi Durdur' : 'Seçimi Başlat'" @click="manageElection(election)">
                            <span class="icon"><i class="material-icons" x-text="election.active ? 'pause_circle_outline' : 'play_circle_outline'"></i></span>
                        </a>
                        <a class="button is-danger has-tooltip-arrow" data-tooltip="Seçimi Sil" @click="deleteElection(election)">
                            <span class="icon"><i class="material-icons">delete</i></span>
                        </a>
                    </div>
                </template>

                <div class="panel-block has-content-justified-center mt-2">
                    <button class="button is-primary is-medium is-fullwidth-mobile"
                            @click="editElection({name: '', status: 0, active: false, categories: [], keys: []})">
                        <span class="icon"><i class="material-icons">add_circle_outline</i></span>
                        <span>Yeni Seçim Oluştur</span>
                    </button>
                </div>
            </nav>

            <!-- TODO: This isn't just a back button it'll be a logout button -->
            <p @click="page = 'admin-login'" class="is-pulled-right has-text-link mt-2 is-clickable">Çıkış Yap</p>
        </div>
    </div>
</template>

<template x-if="modalElection !== null">
    <div class="modal is-active" @keyup.escape.window="modalElection = null">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title" x-text="modalElection.id ? 'Seçimi Düzenle' : 'Yeni Seçim Oluştur'"></p>
                <button class="delete" aria-label="close" @click="modalElection = null"></button>
            </header>

            <section class="modal-card-body">
                <div class="field">
                    <label class="label">Seçim İsmi</label>
                    <div class="control">
                        <input class="input" type="text" x-model="modalElection.name">
                    </div>
                </div>

                <!-- TODO: Number field and generate button -->
                <div class="field">
                    <label class="label">Seçim Anahtarları Sayısı</label>
                    <div class="control">
                        <input class="input" type="text" x-model="modalElection.name">
                    </div>
                </div>

                <!-- TODO: This needs to be a text area with 3 line height -->
                <div class="field">
                    <label class="label">Seçim Anahtarları</label>
                    <div class="control">
                        <input class="input" type="text" x-model="modalElection.name">
                    </div>
                </div>

                <div class="container">
                    <label class="label">Kategoriler</label>
                    <button class="button is-primary is-fullwidth-mobile mb-4" @click="createCategory()">
                        <span class="icon"><i class="material-icons">add_circle_outline</i></span>
                        <span>Yeni Kategori Oluştur</span>
                    </button>

                    <template x-for="(category, index) in modalElection.categories" :key="category">
                        <div class="card" :class="{'mb-4': index < modalElection.categories.length - 1}">
                            <div class="card-content">
                                <div class="field">
                                    <label class="label">Kategori İsmi</label>
                                    <div class="control">
                                        <input class="input" type="text" x-model="category.name" :autofocus="index === modalElection.categories.length - 1">
                                    </div>
                                </div>

                                <label class="label">Adaylar</label>
                                <div class="tagsfield field input is-grouped is-grouped-multiline">
                                    <div class="control">
                                        <input type="hidden" :value="category.candidates.map(c => c.name).join(',')">
                                        <span contenteditable></span>
                                    </div>
                                </div>
                            </div>
                            <footer class="card-footer">
                                <p
                                        class="card-footer-item is-clickable has-text-weight-bold"
                                        @click="moveCategory(index, index - 1)"
                                >
                                    <span class="icon mr-1"><i class="material-icons">arrow_circle_up</i></span>
                                    <span>Yukarı</span>
                                </p>
                                <p
                                        class="card-footer-item is-clickable has-text-weight-bold"
                                        @click="moveCategory(index, index + 1)"
                                >
                                    <span class="icon mr-1"><i class="material-icons">arrow_circle_down</i></span>
                                    <span>Aşağı</span>
                                </p>
                                <p
                                        class="card-footer-item is-clickable has-text-weight-bold has-text-white-bis has-background-danger"
                                        @click="removeCategory(index)"
                                >
                                    <span class="icon"><i class="material-icons">delete</i></span>
                                    <span>Sil</span>
                                </p>
                            </footer>
                        </div>
                    </template>
                </div>
            </section>
            <footer class="modal-card-foot has-content-justified-center">
                <button class="button is-success is-medium is-fullwidth-mobile" :class="{'is-loading': savingElection}" @click="saveElection()">
                    <span class="icon"><i class="material-icons">save</i></span>
                    <span>Kaydet</span>
                </button>
            </footer>
        </div>
    </div>
</template>

<template x-if="modal !== null">
    <div class="modal is-active" @keyup.escape.window="modal = null">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title" x-text="modal.title"></p>
                <button class="delete" aria-label="close" @click="modal = null"></button>
            </header>
            <section class="modal-card-body" x-text="modal.text"></section>
            <footer class="modal-card-foot has-content-justified-right">
                <button class="button is-medium" @click="modal = null">İptal</button>
                <button x-show="modal.onAccept !== null" class="button is-medium is-danger" @click="modal.onAccept(); modal = null">Evet</button>
            </footer>
        </div>
    </div>
</template>
